function Server(e,r){function t(e){e.setTimeout(36e6),a.push(e),e.once("close",function(){arrayRemove(a,a.indexOf(e))})}function n(r,t){function n(){if(arrayRemove(s,s.indexOf(n)),"/"===o){t.setHeader("Content-Type","text/html");var a=e.files.map(function(e,r){return'<li><a download="'+e.name+'" href="/'+r+'">'+e.path+"</a> ("+e.length+" bytes)</li>"}).join("<br>"),d="<h1>"+e.name+"</h1><ol>"+a+"</ol>";return t.end(d)}var u=Number(o.slice(1));if(Number.isNaN(u)||u>=e.files.length)return t.statusCode=404,t.end("404 Not Found");var i=e.files[u];t.setHeader("Accept-Ranges","bytes"),t.setHeader("Content-Type",mime.lookup(i.name)),t.statusCode=200,t.setHeader("transferMode.dlna.org","Streaming"),t.setHeader("contentFeatures.dlna.org","DLNA.ORG_OP=01;DLNA.ORG_CI=0;DLNA.ORG_FLAGS=01700000000000000000000000000000");var c;return r.headers.range?(t.statusCode=206,c=rangeParser(i.length,r.headers.range)[0],debug("range %s",JSON.stringify(c)),t.setHeader("Content-Range","bytes "+c.start+"-"+c.end+"/"+i.length),t.setHeader("Content-Length",c.end-c.start+1)):t.setHeader("Content-Length",i.length),"HEAD"===r.method?t.end():void pump(i.createReadStream(c),t)}if(debug("onRequest"),"OPTIONS"===r.method&&r.headers["access-control-request-headers"])return t.setHeader("Access-Control-Allow-Methods","POST, GET, OPTIONS"),t.setHeader("Access-Control-Allow-Headers",r.headers["access-control-request-headers"]),t.setHeader("Access-Control-Max-Age","1728000"),t.end();r.headers.origin&&t.setHeader("Access-Control-Allow-Origin",r.headers.origin);var o=url.parse(r.url).pathname;return"/favicon.ico"===o?t.end():void(e.ready?n():(s.push(n),e.once("ready",n)))}var o=http.createServer(r),a=[],s=[],d=!1;o.on("connection",t),o.on("request",n);var u=o.close;return o.close=function(r){for(d=!0,e=null,o.removeListener("connection",t),o.removeListener("request",n);s.length;){var a=s.pop();e.removeListener("ready",a)}u.call(o,r)},o.destroy=function(e){a.forEach(function(e){e.destroy()}),d?process.nextTick(e):o.close(e)},o}module.exports=Server;var arrayRemove=require("unordered-array-remove"),debug=require("debug")("webtorrent:server"),http=require("http"),mime=require("mime"),pump=require("pump"),rangeParser=require("range-parser"),url=require("url");
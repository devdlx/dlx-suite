<html><head><link rel="import" href="../dlx-firebase/dlx-firebase.html" charset="utf-8">

</head><body><dom-module id="dlx-user">
    <template>

      <dlx-firebase user="{{user}}"></dlx-firebase>

    </template>
    <script>!function(){var e=[];Polymer({is:"dlx-user",properties:{email:{type:String,notify:!0,value:""},password:{type:String,notify:!0,value:""},_userAuth:{type:Object,notify:!0},_userProfile:{type:Object,notify:!0},user:{type:Object,notify:!0,value:{}},statusKnown:{type:Boolean,notify:!0},provider:{type:String,notify:!0,value:"password"},loggedin:{type:Boolean,notify:!0,value:!1},wait:{type:Boolean,notify:!0,value:!0},_favs:{type:Array,notify:!0}},observers:["checkstatus(statusKnown, _userAuth)"],created:function(){e.push(this)},check:function(e){console.log(e)},authInstagram:function(e){},authSquare:function(e,t,s){var i={access_token:e,merchant_id:t};firebase.database().ref("square/updates/").push(i),this.set("user",{isAdmin:!0})},addFav:function(e){},_computeUser:function(e){var t={};t.accessToken=this._userAuth[this._userAuth.provider].accessToken,t.cachedUserProfile=this._userAuth[this._userAuth.provider].cachedUserProfile,t.displayName=this._userAuth[this._userAuth.provider].displayName,t.id=this._userAuth[this._userAuth.provider].id,t.profileImageURL=this._userAuth[this._userAuth.provider].profileImageURL,t.provider=this._userAuth.provider,t.isAdmin=userDetails.isAdmin||!1,t.loggedin=!0,t.instagram=userDetails.instagram||null,this.set("_userProfile",t),t.uid=this._userAuth.auth.uid,t.token=this._userAuth.token;var s=userDetails.address||{zipcode:""};s.zipcode||(s.zipcode=""),t.address=s,t.card=userDetails.card||{num:"",cvc:"",type:"",exp:"",zipcode:""},this.set("user",t)},login:function(e,t,s){if("squareup"===e){var i="https://squareup.com/oauth2/authorize?client_id=sq0idp-hgAKBib85_Ep66icUHB43g&response_type=token&scope=ITEMS_READ,ITEMS_WRITE,ORDERS_READ,ORDERS_WRITE,MERCHANT_PROFILE_READ,PAYMENTS_READ,CUSTOMERS_READ,CUSTOMERS_WRITE,EMPLOYEES_READ,EMPLOYEES_WRITE,TIMECARDS_READ,TIMECARDS_WRITE";return void(window.location.href=i)}var o={};if("password"===e&&(o.email=t,o.password=s),"google"===e){var r=["https://www.googleapis.com/auth/photos","https://www.googleapis.com/auth/drive","email","profile"];o.scope=r}this.$.firebaseLogin.provider=e,this.$.firebaseLogin.login(o)},logout:function(){this.$.firebaseLogin.logout(),this.set("user",this._computeGuest()),this.wait=!1,this.fire("toast",{text:"Logged out!"})},errorHandler:function(e){this.fire("toast",{text:e.detail.message}),console.log("error: ",e.detail.message)},userSuccessHandler:function(e){this.fire("toast",{text:"Xsuccess!"}),console.log("success: ",this.user)},createUserHandler:function(e){this.$.firebaseLogin.createUser(this.email,this.password),this.fire("toast",{text:"Thanks for joining Charlesies.com "+this.email})},changePasswordHandler:function(e){this.$.firebaseLogin.changePassword(this.email,this.password,this.newPassword),this.fire("toast",{text:"Password for account "+this.email+" has been changed"})},resetPasswordHandler:function(e){this.$.firebaseLogin.sendPasswordResetEmail(this.email),this.fire("toast",{text:"Reset password requset sent to "+this.email})},checkstatus:function(e,t){return e&&t?(t.loggedin=!0,this.wait=!1,!0):(e&&(t||(this.set("user",this._computeGuest()),this.wait=!1)),void(this.wait=!0))},_computeGuest:function(){var e={};return e.uid="guest_"+Date.now(),e.displayName="Guest",e.isAdmin=!1,e.loggedin=!1,e.address={zipcode:""},e.card={num:"",cvc:"",type:"",exp:"",zipcode:""},e},_updateAddress:function(e){var t={street_number:"short_name",route:"long_name",locality:"long_name",administrative_area_level_1:"short_name",country:"long_name",postal_code:"short_name"},s={zipcode:""};if(!e)return s;e.geometry&&("function"==typeof e.geometry.location.lat&&(e.geometry.location.lat=e.geometry.location.lat()),"function"==typeof e.geometry.location.lng&&(e.geometry.location.lng=e.geometry.location.lng()));for(var i=0;i<e.address_components.length;i++){var o=e.address_components[i].types[0];if(t[o]){var r=e.address_components[i][t[o]];"street_number"===o&&(e.street=r),"route"===o&&(e.street+=" "+r),"locality"===o&&(e.city=r),"administrative_area_level_1"===o&&(e.state=r),"postal_code"===o&&(e.zipcode=r.toString())}}this.set("_userProfile.address",e)},_computeCard:function(){}})}();</script>
</dom-module>
</body></html>